accelerator:
  displayName: More Fun
  description: A simple Spring Cloud Function serverless app
  iconUrl: https://external-content.duckduckgo.com/iu/?u=http%3A%2F%2Fwww.newdesignfile.com%2Fpostpic%2F2011%2F02%2F3d-animated-emoticons_81657.png&f=1&nofb=1
  tags:
  - java
  - spring
  - cloud
  - function
  - serverless

  # options for the UI
  options:
  - name: deploymentType
    inputType: select
    choices:
    - value: none
      text: Skip Kubernetes deployment
    - value: k8s-simple
      text: Kubernetes deployment and service
    - value: knative
      text: Knative service
    defaultValue: k8s-simple
    required: true

  - name: enableAppLiveView
    label: App Live View
    dependsOn:
      name: deploymentType
      value: knative
    description: Toggle "On" to enable Application Live View integration.
    inputType: toggle
    dataType: boolean
    defaultValue: false

  - name: projectName
    label: Name
    description: The name for your new project
    display: false
    defaultValue: "test-more"

    - name: toggleIDESupport
      inputType: toggle
      label: Include IDE Support for Java Workloads
      display: true
      dataType: boolean
      defaultValue: false

    - name: repositoryPrefix
      inputType: text
      label: Prefix for the container image repository
      defaultValue: dev.local
      dependsOn:
        name: toggleIDESupport
      required: true

engine:
  merge:
    - include: [ "**" ]
      exclude: [ "README.md", "kubernetes/**" ]
    - include: [ "pom.xml" ]
      chain:
      - type: ReplaceText
        substitutions:
        - text: more-fun
          with: "#artifactId"
    - include: [ "kubernetes/k8s/deployment.yaml", "kubernetes/k8s/service.yaml" ]
      condition: "#deploymentType == 'k8s-simple'"
      chain:
      - type: ReplaceText
        substitutions:
        - text: more-fun
          with: "#artifactId"
      - type: RewritePath
        rewriteTo: "'kubernetes/' + #filename"
    - include: [ "kubernetes/k8s/skaffold.yaml", "kubernetes/k8s/Tiltfile" ]
      condition: "#deploymentType == 'k8s-simple'"
      chain:
      - type: ReplaceText
        substitutions:
        - text: more-fun
          with: "#artifactId"
      - type: RewritePath
        rewriteTo: "#filename"
    - include: [ "kubernetes/knative/service.yaml" ]
      condition: "#deploymentType == 'knative' and !#enableAppLiveView"
      chain:
      - type: ReplaceText
        substitutions:
        - text: more-fun
          with: "#artifactId"
      - type: RewritePath
        rewriteTo: "'kubernetes/' + #filename"
    - include: [ "kubernetes/knative/service-alv.yaml" ]
      condition: "#deploymentType == 'knative' and #enableAppLiveView"
      chain:
      - type: ReplaceText
        substitutions:
        - text: more-fun
          with: "#artifactId"
      - type: RewritePath
        rewriteTo: "'kubernetes/service.yaml'"
    - include: [ "kubernetes/knative/application.properties" ]
      condition: "#deploymentType == 'knative' and #enableAppLiveView"
      chain:
      - type: RewritePath
        rewriteTo: "'src/main/resources/' + #filename"
    - include: [ "kubernetes/knative/skaffold.yaml" ]
      condition: "#deploymentType == 'knative'"
      chain:
      - type: ReplaceText
        substitutions:
        - text: more-fun
          with: "#artifactId"
      - type: RewritePath
        rewriteTo: "#filename"
    - name: README
      type: Combo
      onConflict: Append
      sources:
      - include: [ "README.md"]
        chain:
        - type: ReplaceText
          substitutions:
          - text: more-fun template repo
            with: "#artifactId"
      - include: [ "kubernetes/k8s/DEPLOYING.md" ]
        condition: "#deploymentType == 'k8s-simple'"
        chain:
        - type: RewritePath
          rewriteTo: "'README.md'"
      - include: [ "kubernetes/knative/DEPLOYING.md" ]
        condition: "#deploymentType == 'knative'"
        chain:
        - type: ReplaceText
          substitutions:
          - text: more-fun
            with: "#artifactId"
        - type: RewritePath
          rewriteTo: "'README.md'"
